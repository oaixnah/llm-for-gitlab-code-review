# Internationalization Support

This project supports multi-language interfaces, providing Chinese and English code review services based on different user needs.

## Supported Languages

- **Chinese (zh_CN)**: Default language, providing complete Chinese interface
- **English (en_US)**: English interface, suitable for international teams

## Configuration Methods

### 1. Environment Variable Configuration

Set the `LOCALE` variable in the `.env` file:

```env
# Use Chinese interface (default)
LOCALE=zh_CN

# Use English interface
LOCALE=en_US
```

### 2. Docker Environment Configuration

Add environment variables in `docker-compose.yml`:

```yaml
services:
  app:
    environment:
      - LOCALE=en_US
```

### 3. Runtime Configuration

You can also specify through environment variables at startup:

```bash
LOCALE=en_US uvicorn main:app --host 0.0.0.0 --port 8000
```

## Feature Coverage

Internationalization support covers the following functional modules:

### 1. Code Review Prompts
- System prompt templates
- User prompt templates
- Review standards and evaluation dimensions

### 2. Review Result Display
- Issue descriptions
- Improvement suggestions
- Score summaries
- Auto-generated comments

### 3. Log Messages
- System runtime logs
- Error message prompts
- Status update messages

### 4. API Responses
- Webhook response messages
- Status code descriptions
- Error messages

## Example Comparison

### Chinese Interface (zh_CN)

**Code Review Comment:**
```
#### âš ï¸ å‘ç°çš„é—®é¢˜

ç¼ºå°‘é”™è¯¯å¤„ç†æœºåˆ¶

#### ğŸ’¡ æ”¹è¿›å»ºè®®

å»ºè®®æ·»åŠ try-catchå—è¿›è¡Œå¼‚å¸¸å¤„ç†

#### ğŸ“ æ€»ç»“

**è¯„åˆ†**: 7/10ã€‚ä»£ç é€»è¾‘æ¸…æ™°ï¼Œéœ€è¦å®Œå–„é”™è¯¯å¤„ç†

---

*æ­¤è¯„è®ºç”± gpt-4 è‡ªåŠ¨ç”Ÿæˆï¼ˆè€—æ—¶ï¼š2.3sï¼‰ã€‚*
```

**Log Messages:**
```
åˆå¹¶è¯·æ±‚ project/repo (!123) open å¼€å§‹å¤„ç†
åˆå¹¶è¯·æ±‚ project/repo (!123) å¼€å§‹ä»£ç è¯„å®¡ï¼Œå…± 5 ä¸ªæ–‡ä»¶
```

### English Interface (en_US)

**Code Review Comment:**
```
#### âš ï¸ Issues Found

Missing error handling mechanism

#### ğŸ’¡ Improvement Suggestions

Recommend adding try-catch blocks for exception handling

#### ğŸ“ Summary

**Score**: 7/10. Clear code logic, need to improve error handling

---

*This comment was automatically generated by gpt-4 (Duration: 2.3s).*
```

**Log Messages:**
```
Merge request project/repo (!123) open started processing
Merge request project/repo (!123) started code review, 5 files total
```

## Adding New Languages

If you need to add support for new languages, please follow these steps:

### 1. Create Translation Files

Create new language files in the `locales/` directory, for example `ja_JP.json`:

```json
{
  "system": {
    "prompt": {
      "title": "ã‚ãªãŸã¯å°‚é–€çš„ãªã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™...",
      "aspects": {
        "quality": "**ã‚³ãƒ¼ãƒ‰å“è³ª**: ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã€å‘½åè¦å‰‡ã€ã‚³ãƒ¡ãƒ³ãƒˆå“è³ªã‚’ãƒã‚§ãƒƒã‚¯",
        ...
      }
    }
  },
  ...
}
```

### 2. Create Template Files

Create corresponding template files in the `templates/` directory:

- `file_system_ja_JP.j2`: Japanese system prompt template
- Other template files can continue to use the internationalized version

### 3. Test New Language

Set environment variables and restart the service:

```bash
LOCALE=ja_JP uvicorn main:app --reload
```

## Technical Implementation

### Core Components

1. **i18n.py**: Internationalization management module
   - Translation file loading
   - Language switching
   - Text translation

2. **locales/**: Translation file directory
   - JSON format translation files
   - Support for nested key-value structures
   - Template variable support

3. **templates/**: Template file directory
   - Jinja2 template engine
   - Internationalization template support
   - Dynamic language selection

### Translation Key Naming Convention

- Use dot-separated hierarchical structure
- Module name.function name.specific item
- For example: `log.mr_action_start`, `system.prompt.title`

### Template Variable Support

Translation text supports Python format strings:

```json
{
  "log": {
    "mr_action_start": "Merge request {project} (!{iid}) {action} started processing"
  }
}
```

Usage with variables:

```python
i18n.t('log.mr_action_start', project='repo', iid=123, action='open')
```

## Best Practices

1. **Maintain Translation Consistency**: Use the same translation for the same concept in different locations
2. **Consider Cultural Differences**: Different languages may have different expression habits
3. **Test Completeness**: Ensure all functions work properly in different languages
4. **Document Synchronization**: Update translations for all languages when updating features
5. **Fallback Mechanism**: When translations are missing, the system will automatically fall back to the default language or display key names

## Troubleshooting

### Common Issues

1. **Translation Not Taking Effect**
   - Check `LOCALE` environment variable setting
   - Confirm translation file format is correct
   - Restart service

2. **Partial Text Not Translated**
   - Check if translation file contains corresponding keys
   - Confirm key name spelling is correct
   - Check warning messages in logs

3. **Template Rendering Errors**
   - Check template file syntax
   - Confirm variable names are correct
   - Check detailed error logs

### Debugging Methods

Enable debug mode to view detailed information:

```bash
DEBUG=true LOCALE=en_US uvicorn main:app --reload
```

This will output detailed internationalization processing logs to help locate issues.