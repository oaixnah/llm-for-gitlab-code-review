# Internationalization Support

This project supports multi-language interfaces, providing Chinese and English code review services based on different user needs.

## Supported Languages

- **Chinese (zh_CN)**: Default language, providing complete Chinese interface
- **English (en_US)**: English interface, suitable for international teams

## Configuration Methods

### 1. Environment Variable Configuration

Set the `LOCALE` variable in the `.env` file:

```env
# Use Chinese interface (default)
LOCALE=zh_CN

# Use English interface
LOCALE=en_US
```

### 2. Docker Environment Configuration

Add environment variables in `docker-compose.yml`:

```yaml
services:
  app:
    environment:
      - LOCALE=en_US
```

### 3. Runtime Configuration

You can also specify through environment variables at startup:

```bash
LOCALE=en_US uvicorn main:app --host 0.0.0.0 --port 8000
```

## Feature Coverage

Internationalization support covers the following functional modules:

### 1. Code Review Prompts
- System prompt templates
- User prompt templates
- Review standards and evaluation dimensions

### 2. Review Result Display
- Issue descriptions
- Improvement suggestions
- Score summaries
- Auto-generated comments

### 3. Log Messages
- System runtime logs
- Error message prompts
- Status update messages

### 4. API Responses
- Webhook response messages
- Status code descriptions
- Error messages

## Example Comparison

### Chinese Interface (zh_CN)

**Code Review Comment:**
```
#### ⚠️ 发现的问题

缺少错误处理机制

#### 💡 改进建议

建议添加try-catch块进行异常处理

#### 📝 总结

**评分**: 7/10。代码逻辑清晰，需要完善错误处理

---

*此评论由 gpt-4 自动生成（耗时：2.3s）。*
```

**Log Messages:**
```
合并请求 project/repo (!123) open 开始处理
合并请求 project/repo (!123) 开始代码评审，共 5 个文件
```

### English Interface (en_US)

**Code Review Comment:**
```
#### ⚠️ Issues Found

Missing error handling mechanism

#### 💡 Improvement Suggestions

Recommend adding try-catch blocks for exception handling

#### 📝 Summary

**Score**: 7/10. Clear code logic, need to improve error handling

---

*This comment was automatically generated by gpt-4 (Duration: 2.3s).*
```

**Log Messages:**
```
Merge request project/repo (!123) open started processing
Merge request project/repo (!123) started code review, 5 files total
```

## Adding New Languages

If you need to add support for new languages, please follow these steps:

### 1. Create Translation Files

Create new language files in the `locales/` directory, for example `ja_JP.json`:

```json
{
  "system": {
    "prompt": {
      "title": "あなたは専門的なコードレビューアシスタントです...",
      "aspects": {
        "quality": "**コード品質**: コードスタイル、命名規則、コメント品質をチェック",
        ...
      }
    }
  },
  ...
}
```

### 2. Create Template Files

Create corresponding template files in the `templates/` directory:

- `file_system_ja_JP.j2`: Japanese system prompt template
- Other template files can continue to use the internationalized version

### 3. Test New Language

Set environment variables and restart the service:

```bash
LOCALE=ja_JP uvicorn main:app --reload
```

## Technical Implementation

### Core Components

1. **i18n.py**: Internationalization management module
   - Translation file loading
   - Language switching
   - Text translation

2. **locales/**: Translation file directory
   - JSON format translation files
   - Support for nested key-value structures
   - Template variable support

3. **templates/**: Template file directory
   - Jinja2 template engine
   - Internationalization template support
   - Dynamic language selection

### Translation Key Naming Convention

- Use dot-separated hierarchical structure
- Module name.function name.specific item
- For example: `log.mr_action_start`, `system.prompt.title`

### Template Variable Support

Translation text supports Python format strings:

```json
{
  "log": {
    "mr_action_start": "Merge request {project} (!{iid}) {action} started processing"
  }
}
```

Usage with variables:

```python
i18n.t('log.mr_action_start', project='repo', iid=123, action='open')
```

## Best Practices

1. **Maintain Translation Consistency**: Use the same translation for the same concept in different locations
2. **Consider Cultural Differences**: Different languages may have different expression habits
3. **Test Completeness**: Ensure all functions work properly in different languages
4. **Document Synchronization**: Update translations for all languages when updating features
5. **Fallback Mechanism**: When translations are missing, the system will automatically fall back to the default language or display key names

## Troubleshooting

### Common Issues

1. **Translation Not Taking Effect**
   - Check `LOCALE` environment variable setting
   - Confirm translation file format is correct
   - Restart service

2. **Partial Text Not Translated**
   - Check if translation file contains corresponding keys
   - Confirm key name spelling is correct
   - Check warning messages in logs

3. **Template Rendering Errors**
   - Check template file syntax
   - Confirm variable names are correct
   - Check detailed error logs

### Debugging Methods

Enable debug mode to view detailed information:

```bash
DEBUG=true LOCALE=en_US uvicorn main:app --reload
```

This will output detailed internationalization processing logs to help locate issues.